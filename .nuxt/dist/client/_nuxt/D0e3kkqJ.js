import{a5 as n,a6 as i,l as u,A as c,y as s,E as d}from"#entry";const h=n(async(r,l)=>{let a,t;if(r.path.startsWith("/manage")){l?.path==="/login"&&(console.log("Coming from login page, adding delay for cookie propagation"),[a,t]=i(()=>new Promise(e=>setTimeout(e,100))),await a,t());try{console.log("Auth middleware: Checking authentication for path:",r.path);const e=([a,t]=i(()=>$fetch(u(c.AUTH.ME))),a=await a,t(),a);if(!e?.user)return console.log("Auth middleware: No user found, redirecting to login"),s("/login",{replace:!0});console.log("Auth middleware: User authenticated:",e.user.email);const o=d("auth");o.value&&(o.value.user=e.user,o.value.isAuthenticated=!0,o.value.isLoading=!1)}catch(e){return console.log("Auth middleware: Auth check failed:",e.data?.message||e.message||e),s("/login",{replace:!0})}}});export{h as default};
