{"version":3,"file":"useAuth-D-aEAjNt.js","sources":["../../../../../digital-agency/composables/useAuth.ts"],"sourcesContent":["import { API_ENDPOINTS, buildApiUrl } from '~/constants/api'\n\ninterface User {\n  id: string\n  email: string\n  name: string\n  role: string\n}\n\ninterface AuthResponse {\n  user: User\n  token?: string\n}\n\ninterface AuthMeResponse {\n  user: User\n}\n\ninterface AuthState {\n  user: User | null\n  isAuthenticated: boolean\n  isLoading: boolean\n}\n\nexport const useAuth = () => {\n  const authState = useState<AuthState>('auth', () => ({\n    user: null,\n    isAuthenticated: false,\n    isLoading: true\n  }))\n\n  const login = async (email: string, password: string) => {\n    try {\n      const response = await $fetch<AuthResponse>(buildApiUrl(API_ENDPOINTS.AUTH.LOGIN), {\n        method: 'POST',\n        body: { email, password }\n      })\n\n      authState.value.user = response.user\n      authState.value.isAuthenticated = true\n      authState.value.isLoading = false\n\n      return { success: true, user: response.user }\n    } catch (error: any) {\n      authState.value.user = null\n      authState.value.isAuthenticated = false\n      authState.value.isLoading = false\n\n      return { \n        success: false, \n        error: error.data?.message || error.message || 'Login failed' \n      }\n    }\n  }\n\n  const logout = async () => {\n    try {\n      await $fetch(buildApiUrl(API_ENDPOINTS.AUTH.LOGOUT), {\n        method: 'POST'\n      })\n\n      authState.value.user = null\n      authState.value.isAuthenticated = false\n      authState.value.isLoading = false\n\n      await navigateTo('/')\n    } catch (error) {\n      console.error('Logout failed:', error)\n    }\n  }\n\n  const checkAuth = async () => {\n    if (import.meta.server) return\n\n    try {\n      const response = await $fetch<AuthMeResponse>(buildApiUrl(API_ENDPOINTS.AUTH.ME))\n\n      if (response?.user) {\n        authState.value.user = response.user\n        authState.value.isAuthenticated = true\n        console.log('Auth check successful:', response.user.email)\n      } else {\n        authState.value.user = null\n        authState.value.isAuthenticated = false\n        console.log('Auth check: no user found')\n      }\n    } catch (error) {\n      authState.value.user = null\n      authState.value.isAuthenticated = false\n      console.log('Auth check error:', error)\n    } finally {\n      authState.value.isLoading = false\n    }\n  }\n\n  const setupAdmin = async (email: string, password: string, name?: string) => {\n    try {\n      const response = await $fetch(buildApiUrl(API_ENDPOINTS.AUTH.SETUP), {\n        method: 'POST',\n        body: { email, password, name }\n      })\n\n      return { success: true, data: response }\n    } catch (error: any) {\n      return { \n        success: false, \n        error: error.data?.message || error.message || 'Setup failed' \n      }\n    }\n  }\n\n  return {\n    user: readonly(computed(() => authState.value.user)),\n    isAuthenticated: readonly(computed(() => authState.value.isAuthenticated)),\n    isLoading: readonly(computed(() => authState.value.isLoading)),\n    login,\n    logout,\n    checkAuth,\n    setupAdmin\n  }\n}"],"names":[],"mappings":";;;AAwBO,MAAM,UAAU,MAAM;AAC3B,QAAM,YAAY,SAAoB,QAAQ,OAAO;AAAA,IACnD,MAAM;AAAA,IACN,iBAAiB;AAAA,IACjB,WAAW;AAAA,EAAA,EACX;AAEF,QAAM,QAAQ,OAAO,OAAe,aAAqB;AACvD,QAAI;AACF,YAAM,WAAW,MAAM,OAAqB,YAAY,cAAc,KAAK,KAAK,GAAG;AAAA,QACjF,QAAQ;AAAA,QACR,MAAM,EAAE,OAAO,SAAA;AAAA,MAAS,CACzB;AAED,gBAAU,MAAM,OAAO,SAAS;AAChC,gBAAU,MAAM,kBAAkB;AAClC,gBAAU,MAAM,YAAY;AAE5B,aAAO,EAAE,SAAS,MAAM,MAAM,SAAS,KAAA;AAAA,IACzC,SAAS,OAAY;AACnB,gBAAU,MAAM,OAAO;AACvB,gBAAU,MAAM,kBAAkB;AAClC,gBAAU,MAAM,YAAY;AAE5B,aAAO;AAAA,QACL,SAAS;AAAA,QACT,OAAO,MAAM,MAAM,WAAW,MAAM,WAAW;AAAA,MAAA;AAAA,IAEnD;AAAA,EACF;AAEA,QAAM,SAAS,YAAY;AACzB,QAAI;AACF,YAAM,OAAO,YAAY,cAAc,KAAK,MAAM,GAAG;AAAA,QACnD,QAAQ;AAAA,MAAA,CACT;AAED,gBAAU,MAAM,OAAO;AACvB,gBAAU,MAAM,kBAAkB;AAClC,gBAAU,MAAM,YAAY;AAE5B,YAAM,WAAW,GAAG;AAAA,IACtB,SAAS,OAAO;AACd,cAAQ,MAAM,kBAAkB,KAAK;AAAA,IACvC;AAAA,EACF;AAEA,QAAM,YAAY,YAAY;AACJ;AAAA,EAqB1B;AAEA,QAAM,aAAa,OAAO,OAAe,UAAkB,SAAkB;AAC3E,QAAI;AACF,YAAM,WAAW,MAAM,OAAO,YAAY,cAAc,KAAK,KAAK,GAAG;AAAA,QACnE,QAAQ;AAAA,QACR,MAAM,EAAE,OAAO,UAAU,KAAA;AAAA,MAAK,CAC/B;AAED,aAAO,EAAE,SAAS,MAAM,MAAM,SAAA;AAAA,IAChC,SAAS,OAAY;AACnB,aAAO;AAAA,QACL,SAAS;AAAA,QACT,OAAO,MAAM,MAAM,WAAW,MAAM,WAAW;AAAA,MAAA;AAAA,IAEnD;AAAA,EACF;AAEA,SAAO;AAAA,IACL,MAAM,SAAS,SAAS,MAAM,UAAU,MAAM,IAAI,CAAC;AAAA,IACnD,iBAAiB,SAAS,SAAS,MAAM,UAAU,MAAM,eAAe,CAAC;AAAA,IACzE,WAAW,SAAS,SAAS,MAAM,UAAU,MAAM,SAAS,CAAC;AAAA,IAC7D;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA;AAEJ;"}