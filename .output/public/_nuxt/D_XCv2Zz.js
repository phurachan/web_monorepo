import{a5 as l,a6 as s,y as n}from"#entry";import{u as c}from"./IEGI5U38.js";const d=l(async(o,u)=>{let e,a;if(o.path.startsWith("/agency-cms/manage")){console.log("Simple auth middleware: Checking authentication for:",o.path),u?.path==="/login"&&(console.log("Coming from login, waiting for cookies to be set..."),[e,a]=s(()=>new Promise(t=>setTimeout(t,500))),await e,a());try{if(c("auth-status").value==="authenticated"){console.log("Simple auth middleware: Auth status cookie found, user is authenticated");return}console.log("Simple auth middleware: No auth status cookie, checking API...");const i=([e,a]=s(()=>fetch("/api/agency-cms/auth/me",{credentials:"include"}).then(r=>r.json())),e=await e,a(),e);if(!i?.user)return console.log("Simple auth middleware: No user found in API response"),n("/agency-cms/login",{replace:!0});console.log("Simple auth middleware: User authenticated via API:",i.user.email)}catch(t){return console.log("Simple auth middleware: Authentication failed:",t.data?.message||t.message||t),n("/agency-cms/login",{replace:!0})}}});export{d as default};
